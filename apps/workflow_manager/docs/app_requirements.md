# Workflow Manager 要求（Requirements）

本書は `apps/workflow_manager/` の要求（What/Why）を定義します。詳細な利用方法・手順・実装は `apps/workflow_manager/README.md` と `apps/workflow_manager/docs/`、ワークフロー定義、データ、同期スクリプトを正とします。

## 1. 対象

ITSM のサービスリクエストを n8n ワークフローとして実装し、運用者・エージェント（例: AIOps Agent）が参照できる「カタログ API」として提供するワークフロー群。

## 2. 目的

運用手順（サービス制御等）をワークフローとしてカタログ化し、参照・実行要求の窓口を統一する。

## 2.1 代表ユースケース（DQ/設計シナリオ由来）

本セクションは `apps/workflow_manager/docs/dq/dq.md` の設計スコープ/主要リスクを、運用上のユースケースへ落とし込んだものです。

- UC-WM-01: カタログ API（list）で利用可能なワークフロー一覧を取得する（クライアント参照）
- UC-WM-02: カタログ API（get）でワークフロー詳細を取得する（クライアントが実行候補を構築するため）
- UC-WM-03: `N8N_WORKFLOWS_TOKEN` で認証し、不正参照（漏えい）を防ぐ（未認証は拒否する）
- UC-WM-04: 代表的なサービス制御（例: Sulu 起動/停止）を実行し、入力 validation と安全側の失敗を保証する
- UC-WM-05: クライアント互換を壊さない（list/get の contract を維持し、変更時は OQ で互換性を確認する）

## 3. スコープ

### 3.1 対象（In Scope）

- ワークフローカタログ API による一覧/取得（クライアント参照）の提供
- サービス制御等のワークフロー提供（例: サービス起動/停止）
- クライアント（AIOps Agent 等）からの参照・実行要求に応答する Webhook 提供

### 3.2 対象外（Out of Scope）

- 個別サービスの運用設計（何をいつ止める/起動する等）の最終判断
- 外部サービス（GitLab/サービス制御基盤等）自体の製品バリデーション

## 4. 機能要件（要約）

- 入力: クライアントからの参照要求（一覧/取得）および実行要求（サービス制御等）
- 処理: カタログから対象ワークフローを解決し、必要な外部 API を呼び出す
- 出力: 実行結果（成功/失敗、参照情報）をクライアントへ返却する

## 5. 非機能要件（共通）

- セキュリティ: 呼び出し元の認証/認可と最小権限トークン運用
- 監査性: どのワークフローが誰の要求で実行されたか追跡可能であること（方式は実装で定義）
- 可用性: 一時障害時のリトライや適切なエラーハンドリングにより、運用を阻害しない
